<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>üçé Obst Obsession üçá</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      background: #f0f0f0;
      margin: 0;
      padding: 20px;
      user-select: none;
    }
    h1 {
      margin-bottom: 10px;
      font-size: 2.5em;
    }
    table {
      border-collapse: collapse;
      margin: 20px auto;
    }
    td {
      width: 12vw;
      height: 12vw;
      max-width: 60px;
      max-height: 60px;
      border: 1px solid #333;
      text-align: center;
      vertical-align: middle;
      font-size: 2em;
      cursor: pointer;
      background: #fff;
      transition: background 0.2s;
    }
    .fixed {
      background: #d0eaff;
      cursor: default;
    }
    button {
      margin: 10px;
      padding: 12px 24px;
      font-size: 1em;
      cursor: pointer;
    }
    @media (max-width: 600px) {
      td {
        width: 11vw;
        height: 11vw;
        font-size: 1.8em;
      }
      button {
        font-size: 0.9em;
        padding: 10px 18px;
      }
    }
    #victory {
      display: none;
      font-size: 2em;
      color: green;
      animation: pop 0.8s ease forwards;
    }
    @keyframes pop {
      0% { transform: scale(0.5); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }
  </style>
</head>
<body>

<h1>üçé Obst Obsession üçá</h1>

<table id="grid"></table>

<div>
  <button onclick="checkSolution()">‚úÖ L√∂sung pr√ºfen</button>
  <button onclick="resetGame()">üîÑ Neues Spiel</button>
</div>

<div id="victory">üéâ Super gemacht! üéâ</div>

<script>
  const fruits = ["", "üçé", "üçå", "üçà", "üçá"];
  let fixedCells = {};

  function createGrid() {
    const table = document.getElementById("grid");
    table.innerHTML = "";
    for (let r = 0; r < 8; r++) {
      const row = table.insertRow();
      for (let c = 0; c < 8; c++) {
        const cell = row.insertCell();
        const key = `${r},${c}`;
        if (fixedCells[key]) {
          cell.textContent = fixedCells[key];
          cell.className = 'fixed';
        } else {
          cell.onclick = () => {
            let current = fruits.indexOf(cell.textContent);
            cell.textContent = fruits[(current + 1) % fruits.length];
          };
        }
      }
    }
  }

  function checkSolution() {
    const table = document.getElementById("grid");
    let valid = true;

    for (let i = 0; i < 8; i++) {
      let rowCounts = {}, colCounts = {};
      for (let j = 0; j < 8; j++) {
        const rowFruit = table.rows[i].cells[j].textContent;
        const colFruit = table.rows[j].cells[i].textContent;

        rowCounts[rowFruit] = (rowCounts[rowFruit] || 0) + 1;
        colCounts[colFruit] = (colCounts[colFruit] || 0) + 1;

        if (j < 7) {
          if (rowFruit !== "" && rowFruit === table.rows[i].cells[j+1].textContent) valid = false;
          if (colFruit !== "" && colFruit === table.rows[j+1].cells[i].textContent) valid = false;
        }
      }
      for (let fruit of fruits.slice(1)) {
        if (rowCounts[fruit] !== 2 || colCounts[fruit] !== 2) valid = false;
      }
    }

    if (valid) {
      document.getElementById("victory").style.display = "block";
    } else {
      alert("Falsch gemach üò≠");
    }
  }

  function generateSolvablePuzzle() {
    let attempts = 0;
    while (true) {
      fixedCells = {};
      attempts++;
      placeRandomStartFields();
      let grid = Array.from({ length: 8 }, () => Array(8).fill(""));
      for (let key in fixedCells) {
        const [r, c] = key.split(",").map(Number);
        grid[r][c] = fixedCells[key];
      }
      if (solve(grid)) break;
    }
  }

  function placeRandomStartFields() {
    let placed = 0;
    while (placed < 25) {
      let r = Math.floor(Math.random() * 8);
      let c = Math.floor(Math.random() * 8);
      let key = `${r},${c}`;
      if (fixedCells[key]) continue;
      let fruit = fruits.slice(1)[Math.floor(Math.random() * 4)];
      let neighbours = [
        `${r-1},${c}`, `${r+1},${c}`,
        `${r},${c-1}`, `${r},${c+1}`
      ];
      if (neighbours.some(n => fixedCells[n] === fruit)) continue;
      fixedCells[key] = fruit;
      placed++;
    }
  }

  function solve(grid) {
    function isValid(r, c, fruit) {
      let rowCount = grid[r].filter(f => f === fruit).length;
      let colCount = grid.map(row => row[c]).filter(f => f === fruit).length;
      if (rowCount >= 2 || colCount >= 2) return false;
      if (r > 0 && grid[r-1][c] === fruit) return false;
      if (r < 7 && grid[r+1][c] === fruit) return false;
      if (c > 0 && grid[r][c-1] === fruit) return false;
      if (c < 7 && grid[r][c+1] === fruit) return false;
      return true;
    }

    function backtrack(r, c) {
      if (c === 8) { c = 0; r++; if (r === 8) return true; }
      if (grid[r][c] !== "") return backtrack(r, c+1);
      for (let fruit of fruits.slice(1)) {
        if (isValid(r, c, fruit)) {
          grid[r][c] = fruit;
          if (backtrack(r, c+1)) return true;
          grid[r][c] = "";
        }
      }
      return false;
    }
    return backtrack(0,0);
  }

  function resetGame() {
    document.getElementById("victory").style.display = "none";
    generateSolvablePuzzle();
    createGrid();
  }

  resetGame();
</script>

</body>
</html>
